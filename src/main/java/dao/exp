import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

/**
 * Η κλάση CashflowDAO είναι υπεύθυνη για την επικοινωνία
 * της Java με τη βάση δεδομένων όσον αφορά τον πίνακα "cashflow".
 * Περιέχει μεθόδους για ανάγνωση, εισαγωγή και ενημέρωση εγγραφών.
 */
public class CashflowDAO {

    /**
     * Δημιουργεί ένα αντικείμενο Cashflow από μία γραμμή αποτελεσμάτων της SQL.
     * Κάθε στήλη της γραμμής αντιστοιχίζεται στα πεδία του αντικειμένου.
     */
    private Cashflow mapRow(ResultSet rs) throws SQLException {
        return new Cashflow(
            rs.getInt("id"),
            rs.getInt("year_id"),
            rs.getString("name"),
            rs.getString("type"),
            rs.getDouble("amount")
        );
    }

    /**
     * Επιστρέφει όλες τις εγγραφές του πίνακα cashflow από τη βάση δεδομένων.
     * Δημιουργεί λίστα αντικειμένων τύπου Cashflow.
     */
    public List<Cashflow> selectCashFlow() {
        List<Cashflow> cashflows = new ArrayList<>();
        String sql = "SELECT * FROM cashflow";

        try (Connection connection = DatabaseConnection.getConnection();
             PreparedStatement statement = connection.prepareStatement(sql);
             ResultSet resultSet = statement.executeQuery()) {

            while (resultSet.next()) {
                cashflows.add(mapRow(resultSet));
            }

        } catch (SQLException e) {
            System.err.println("Error found at selectCashFlow");
            e.printStackTrace();
        }
        return cashflows;
    }

    /**
     * Εισάγει μια νέα εγγραφή cashflow στη βάση δεδομένων.
     * Χρησιμοποιεί PreparedStatement για ασφάλεια και αποφυγή λαθών.
     */
    public void addCashFlow(Cashflow cashflow) {
        String sql = "INSERT INTO cashflow(year_id, name, type, amount) VALUES(?, ?, ?, ?)";

        try (Connection connection = DatabaseConnection.getConnection();
             PreparedStatement preparedStatement = connection.prepareStatement(sql)) {

            preparedStatement.setInt(1, cashflow.getYearId());
            preparedStatement.setString(2, cashflow.getName());
            preparedStatement.setString(3, cashflow.getType());
            preparedStatement.setDouble(4, cashflow.getAmount());
            preparedStatement.executeUpdate();

        } catch (SQLException e) {
            System.err.println("Error found at addCashFlow");
            e.printStackTrace();
        }
    }

    /**
     * Ενημερώνει μια υπάρχουσα εγγραφή cashflow στη βάση δεδομένων
     * με τα νέα δεδομένα που περιέχονται στο αντικείμενο cashflow.
     */
    public void updateCashFlow(Cashflow cashflow) {
        String sql = "UPDATE cashflow SET year_id = ?, name = ?, type = ?, amount = ? WHERE id = ?";

        try (Connection connection = DatabaseConnection.getConnection();
             PreparedStatement preparedStatement = connection.prepareStatement(sql)) {

            preparedStatement.setInt(1, cashflow.getYearId());
            preparedStatement.setString(2, cashflow.getName());
            preparedStatement.setString(3, cashflow.getType());
            preparedStatement.setDouble(4, cashflow.getAmount());
            preparedStatement.setInt(5, cashflow.getId());
            preparedStatement.executeUpdate();

        } catch (SQLException e) {
            System.err.println("Error found at updateCashFlow");
            e.printStackTrace();
        }
    }
}

